
<div class="layout">
  <div class="left">
<!--  <button class="adminbutton" id="csv">Add Request</button>  -->
  <button class="adminbutton" id="values-csv">Upload Values</button>
  <button class="adminbutton" id="users-csv">Upload Users</button>
  <button class="adminbutton" id="pto-csv">Import Requests</button>
  </div>
  <div class="right">
      <div id="searchbar">
        <input type="text" id="search" onkeyup="filter()" placeholder="Filter by name.." title="Filter by name">
      </div>
    <div class="all-agents">
        <table id="agent-table">
          <tbody>
            <thead>
              <tr>
                <th>Agent Name</th>
                <th>PTO Points</th>
              </tr>
            </thead>
              <% @agents.each do |agent| %>
            <tr class="agent-row">
              <td class="agent-name"><%= link_to "#{agent.name}", show_user_path(agent) %></td>
              <td class="agent-points"><%= agent.bank_value %></td>
            </tr>
              <% end %>
          </tbody>
        </table>
      </div>
  </div>  
  <div class="center">
    <h4>Agents working today</h4>
    <div class="center-content">
    <table>
        <tr>
          <td class="off-header">1A</td>
          <td class="off-header">2A</td>
          <td class="off-header">3A</td>
          <td class="off-header">4A</td>
          <td class="off-header">5A</td>
          <td class="off-header">6A</td>
          <td class="off-header">7A</td>
          <td class="off-header">8A</td>
          <td class="off-header">9A</td>
          <td class="off-header">10A</td>
          <td class="off-header">11A</td>
          <td class="off-header">12P</td>
          <td class="off-header">1P</td>
          <td class="off-header">2P</td>
          <td class="off-header">3P</td>
          <td class="off-header">4P</td>
          <td class="off-header">5P</td>
          <td class="off-header">6P</td>
          <td class="off-header">7P</td>
          <td class="off-header">8P</td>
          <td class="off-header">9P</td>
          <td class="off-header">10P</td>
          <td class="off-header">11P</td>
          <td class="off-header">12A</td>
        </tr>
      </table>
        <% if @offtoday.is_a? String %>
          <div class="errormessage"><%= @offtoday %></div>
        <% else %>
          <% @scheduled.each do |agent| %>
              <div class="working-grid">
              <% if agent.pto_requests.where(request_date: Date.today).empty? %>
              <div class="grid-overflow <%= agent.position %> <%= agent.team %> start-<%= Time.parse(agent.start_time).in_time_zone("Mountain Time (US & Canada)").to_s[11..15].tr(':','') %>"><%= agent.name %></div></div>
              <% else %>
              <div class="offtoday"><%= agent.name %></div>
              <% end %>
            <% end %>
        <% end %>
    </div>
  </div>
</div>

    <div id="upload-users" class="admin-modal">
      <div class="upload-users-content">
        <div class="modal-header">Import Agents CSV
          <div class="close2">x</div>
        </div>
              <%= form_tag import_agents_path, multipart: true do %>
              <%= file_field_tag :file %>
              <%= submit_tag "Import Agents CSV" %>
              <% end %> 
      </div>
    </div>

    <div id="upload-values" class="admin-modal">
      <div class="upload-values-content">
        <div class="modal-header">Import Date Value CSV
          <div class="close2">x</div>
        </div>
              <%= form_tag import_date_values_path, multipart: true do %>
              <%= file_field_tag :file %>
              <%= submit_tag "Import Value CSV" %>
              <% end %> 
      </div>
    </div>

    <div id="upload-requests" class="admin-modal">
      <div class="upload-values-content">
        <div class="modal-header">Import PTO Requests CSV
          <div class="close2">x</div>
        </div>
              <%= form_tag import_request_pto_requests_path, multipart: true do %>
              <%= file_field_tag :file %>
              <%= submit_tag "Import PTO requests CSV" %>
              <% end %> 
      </div>
    </div>

    </div>
  </div>
</div>

<script>
    function filter() {
        var input, filter, table, tr, td, i, ii;
        input = document.getElementById("search");
        filter = input.value.toUpperCase();
        table = document.getElementById("agent-table");
        tr = table.querySelectorAll("tbody tr");
        for (i = 0; i < tr.length; i++) {
            var tds = tr[i].getElementsByTagName("td");
            var found = false;
            for (ii = 0; ii < tds.length && !found; ii++) {
                if (tds[ii].textContent.toUpperCase().indexOf(filter) > -1) {
                    found = true;
                    break;
                }
            }
            tr[i].style.display = found?"":"none";
        }
    }
</script>

<script>
  var modal = document.getElementById('upload-users');
  var modal2 = document.getElementById('upload-values');
  var modal3 = document.getElementById('upload-requests');
  var btn = document.getElementById("users-csv");
  var btn2 = document.getElementById("values-csv");
  var btn3 = document.getElementById("pto-csv");
  var span = document.getElementsByClassName("close2")[0];
  var span2 = document.getElementsByClassName("close2")[1];
  var span3 = document.getElementsByClassName("close2")[2];
  btn.onclick = function() {
    modal.style.display = "block";
  }
  btn2.onclick = function() {
    modal2.style.display = "block";
  }
  btn3.onclick = function() {
    modal3.style.display = "block";
  }
  span.onclick = function() {
    modal.style.display = "none"
  }
  span2.onclick = function() {
    modal2.style.display = "none";
  }
  span3.onclick = function() {
    modal3.style.display = "none";
  }
  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
    else if (event.target == modal2) {
      modal2.style.display = "none";
    }
    else if (event.target == modal3) {
      modal3.style.display = "none";
    }
  }
</script>

